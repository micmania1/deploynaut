!function e(t,a,s){function n(c,l){if(!a[c]){if(!t[c]){var o="function"==typeof require&&require;if(!l&&o)return o(c,!0);if(r)return r(c,!0);var i=new Error("Cannot find module '"+c+"'");throw i.code="MODULE_NOT_FOUND",i}var p=a[c]={exports:{}};t[c][0].call(p.exports,function(e){var a=t[c][1][e];return n(a?a:e)},p,p.exports,e,t,a,s)}return a[c].exports}for(var r="function"==typeof require&&require,c=0;c<s.length;c++)n(s[c]);return n}({1:[function(e,t,a){var s=e("./deployment_dialog.jsx"),n=e("./create_project_progress.jsx"),r=document.getElementById("deployment-dialog-holder");r&&React.render(React.createElement(s,{context:environmentConfigContext}),r);var c=document.getElementById("create-project-progress-holder");c&&React.render(React.createElement(n,{statusUrl:createProjectStatusUrl,deployKey:deployKey,deployKeyTestUrl:deployKeyTestUrl,initalCanAccessRepo:canAccessRepo}),c)},{"./create_project_progress.jsx":2,"./deployment_dialog.jsx":5}],2:[function(e,t,a){var s=e("./deploy_key_test.jsx"),n=React.createClass({displayName:"CreateProjectProgress",checkInterval:!1,getInitialState:function(){return{complete:!1,checkingStatus:!1}},componentDidMount:function(){this.checkInterval=window.setInterval(this.handleCheckStatus,1e4)},handleCheckStatus:function(){this.state.checkingStatus||this.checkStatus()},checkStatus:function(){var e=this;$.ajax({url:this.props.statusUrl,dataType:"json",cache:!1,type:"GET",success:function(t){t.complete&&(e.setState({complete:!0}),window.clearInterval(this.checkInterval)),e.setState({checkingStatus:!1})}.bind(this),error:function(t,a,s){e.setState({checkingStatus:!1})}.bind(this)})},reload:function(e){e.preventDefault(),window.location.reload()},render:function(){if(!this.state.complete)var e=React.createElement(s,{deployKey:this.props.deployKey,initialCanAccessRepo:this.props.canAccessRepo,deployKeyTestUrl:this.props.deployKeyTestUrl});return this.state.complete?React.createElement("div",{className:"row"},React.createElement("i",{className:"fa fa-check text-success fa-5x"}),React.createElement("h1",null,"We're done!"),React.createElement("p",null,"Your environments are setup and ready to go!"),React.createElement("p",null,React.createElement("a",{href:"#",onClick:this.reload,className:"btn btn-primary"},"Take me to my environments!")),e):React.createElement("div",{className:"row"},React.createElement("div",{className:"row progress-icon"},React.createElement("i",{className:"fa fa-cog fa-spin fa-5x"})),React.createElement("h1",null,"Your environments are on their way!"),React.createElement("p",null,"We're currently building your environments which can take 15-45 minutes, depending on current traffic."),e)}});t.exports=n},{"./deploy_key_test.jsx":3}],3:[function(e,t,a){var s=React.createClass({displayName:"DeployKeyTest",getInitialState:function(){return{loading:!1,tested:!1,canAccessRepo:this.props.initialCanAccessRepo}},render:function(){return React.createElement("div",{className:"add-deploy-key"},React.createElement("h2",null,"Add your deploy key..."),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6 col-md-offset-3"},React.createElement("p",null,"To give us access to your private repositories you will need to add the deploy key below. How you add this will differ depending on what platform you host your GIT repository on:"),React.createElement("ul",{className:"list-inline"},React.createElement("li",null,React.createElement("i",{className:"fa fa-github"})," ",React.createElement("a",{href:"https://developer.github.com/guides/managing-deploy-keys/#deploy-keys",target:"_blank"},"Github")),React.createElement("li",null,React.createElement("i",{className:"fa fa-bitbucket"})," ",React.createElement("a",{href:"https://confluence.atlassian.com/bitbucket/use-deployment-keys-294486051.html",target:"_blank"},"Bitbucket")),React.createElement("li",null,React.createElement("img",{src:"deploynaut/img/gitlab.png",alt:"Gitlab",className:"gitlab-icon"})," ",React.createElement("a",{href:"http://doc.gitlab.com/ce/ssh/README.html#deploy-keys",target:"_blank"},"Gitlab"))))),React.createElement("div",{className:"col-md-8 col-md-offset-2 text-left",id:"deploy-key-test-holder"},React.createElement("pre",{className:"deploy-key"},this.props.deployKey)),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-8 col-md-offset-2"},this.button())))},testAccess:function(){this.setState({loading:!0});var e=this;$.ajax({url:this.props.deployKeyTestUrl,dataType:"json",cache:!1,type:"GET",success:function(t){console.log(t.canAccessRepo),e.setState({loading:!1,tested:!0,canAccessRepo:t.canAccessRepo})}.bind(this),error:function(t,a,s){e.setState({loading:!1,tested:!0,canAccesRepo:!1})}.bind(this)})},handleTestAccess:function(e){e.preventDefault(),this.testAccess()},button:function(){var e={__html:"Test Access"},t=!1,a="btn btn-primary";this.state.loading?(e={__html:'<i class="fa fa-cog fa-spin"></i> Attempting to clone repository...'},t=!0):this.state.canAccessRepo&&(e={__html:'<i class="fa fa-check"></i> We can access your repository'},t=!0,a="btn btn-success");var s;!this.state.tested||this.state.canAccessRepo||this.state.loading||(s=React.createElement("p",{className:"alert alert-danger"},"We're having trouble accessing your repository."));var n=React.createElement("button",{href:"#",className:a,onClick:this.handleTestAccess,disabled:t,dangerouslySetInnerHTML:e});return React.createElement("div",null,s,n)}});t.exports=s},{}],4:[function(e,t,a){var s=e("./events.js"),n=e("./helpers.js"),r=e("./summary_table.jsx"),c=React.createClass({displayName:"DeployPlan",loadingSub:null,loadingDoneSub:null,getInitialState:function(){return{loading_changes:!1,deploy_disabled:!1,deployHover:!1}},componentDidMount:function(){var e=this;this.loadingSub=s.subscribe("change_loading",function(){e.setState({loading_changes:!0})}),this.loadingDoneSub=s.subscribe("change_loading/done",function(){e.setState({loading_changes:!1})})},deployHandler:function(e){e.preventDefault(),this.setState({deploy_disabled:!0}),Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/start-deploy",data:{strategy:this.props.summary,SecurityID:this.props.summary.SecurityID}})).then(function(e){window.location=e.url},function(e){console.error(e)})},mouseEnterHandler:function(e){this.setState({deployHover:!0})},mouseLeaveHandler:function(e){this.setState({deployHover:!1})},canDeploy:function(){return"success"===this.props.summary.validationCode||"warning"===this.props.summary.validationCode},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0},showNoChangesMessage:function(){var e=this.props.summary;return e.initialState===!0?!1:"undefined"===e.messages?!0:this.isEmpty(e.changes)&&0===e.messages.length},actionTitle:function(){var e=this.props.summary.actionTitle;return"undefined"==typeof e||""===e?"Make a selection":this.props.summary.actionTitle},render:function(){var e=this.props.summary.messages;this.showNoChangesMessage()&&(e=[{text:"There are no changes but you can deploy anyway if you wish.",code:"success"}]);var t;this.canDeploy()&&(t=React.createElement("div",{className:"section",onMouseEnter:this.mouseEnterHandler,onMouseLeave:this.mouseLeaveHandler},React.createElement("button",{value:"Confirm Deployment",className:"deploy pull-left",disabled:this.state.deploy_disabled,onClick:this.deployHandler},this.actionTitle()),React.createElement(l,{activated:this.state.deployHover,context:this.props.context,summary:this.props.summary})));var a=n.classNames({header:!0,inactive:!this.canDeploy(),loading:this.state.loading_changes});return React.createElement("div",null,React.createElement("div",{className:"section"},React.createElement("div",{className:a},React.createElement("span",{className:"status-icon"}),React.createElement("span",{className:"numberCircle"},"2")," Review changes"),React.createElement(o,{messages:e}),React.createElement(r,{changes:this.props.summary.changes})),t)}}),l=React.createClass({displayName:"QuickSummary",render:function(){var e="fast"===this.props.summary.actionCode?"code-only":"full",t=[];this.props.summary.estimatedTime&&this.props.summary.estimatedTime>0&&(t=[React.createElement("dt",null,"Duration:"),React.createElement("dd",null,this.props.summary.estimatedTime," min approx.")]);var a=n.classNames({activated:this.props.activated,"quick-summary":!0}),s=null;if("undefined"!=typeof this.props.context.deployHelp&&this.props.context.deployHelp&&(s=React.createElement("a",{target:"_blank",className:"small",href:this.props.context.deployHelp},"more info")),this.props.context.siteUrl)var r=React.createElement("a",{target:"_blank",href:this.props.context.siteUrl},this.props.context.envName);else var r=React.createElement("span",null,this.props.context.envName);return React.createElement("dl",{className:a},React.createElement("dt",null,"Environment:"),React.createElement("dd",null,r),React.createElement("dt",null,"Deploy type:"),React.createElement("dd",null,e," ",s),t)}}),o=React.createClass({displayName:"MessageList",render:function(){if(this.props.messages.length<1)return null;if("undefined"==typeof this.props.messages)return null;var e=0,t=this.props.messages.map(function(t){return e++,React.createElement(i,{key:e,message:t})});return React.createElement("div",null,t)}}),i=React.createClass({displayName:"Message",render:function(){var e={error:"alert alert-danger",warning:"alert alert-warning",success:"alert alert-info"},t=e[this.props.message.code];return React.createElement("div",{className:t,role:"alert",dangerouslySetInnerHTML:{__html:this.props.message.text}})}});t.exports=c},{"./events.js":6,"./helpers.js":7,"./summary_table.jsx":8}],5:[function(e,t,a){var s=e("./events.js"),n=e("./helpers.js"),r=e("./deploy_plan.jsx"),c=React.createClass({displayName:"DeploymentDialog",loadingSub:null,loadingDoneSub:null,errorSub:null,getInitialState:function(){return{loading:!1,loadingText:"",errorText:"",fetched:!0,last_fetched:""}},componentDidMount:function(){var e=this;this.loadingSub=s.subscribe("loading",function(t){e.setState({loading:!0,success:!1,loadingText:t})}),this.loadingDoneSub=s.subscribe("loading/done",function(){e.setState({loading:!1,loadingText:"",success:!0})}),this.errorSub=s.subscribe("error",function(t){e.setState({errorText:t,loading:!1,loadingText:"",success:!1})})},componentWillUnmount:function(){this.loadingSub.remove(),this.loadingDoneSub.remove(),this.errorSub.remove()},handleClick:function(e){e.preventDefault(),s.publish("loading","Fetching latest code…"),this.setState({fetched:!1});var t=this;Q($.ajax({type:"POST",dataType:"json",url:this.props.context.projectUrl+"/fetch"})).then(this.waitForFetchToComplete,this.fetchStatusError).then(function(){s.publish("loading/done"),t.setState({fetched:!0})})["catch"](this.fetchStatusError).done()},waitForFetchToComplete:function(e){var t=this;return this.getFetchStatus(e).then(function(a){return"Complete"===a.status?a:"Failed"===a.status?$.Deferred(function(e){return e.reject(a)}).promise():t.waitForFetchToComplete(e)})},getFetchStatus:function(e){return Q($.ajax({type:"GET",url:e.href,dataType:"json"}))},fetchStatusError:function(e){var t="Unknown error";"undefined"!=typeof e.responseText?t=e.responseText:"undefined"!=typeof e.message&&(t=e.message),s.publish("error",t)},lastFetchedHandler:function(e){this.setState({last_fetched:e})},render:function(){var e,t=n.classNames({"deploy-dropdown":!0,loading:this.state.loading,success:this.state.success});return""!==this.state.errorText?e=React.createElement(o,{message:this.state.errorText}):this.state.fetched?e=React.createElement(p,{context:this.props.context,data:this.props.data,lastFetchedHandler:this.lastFetchedHandler}):this.state.loading&&(e=React.createElement(l,{message:"Fetching latest code…"})),React.createElement("div",null,React.createElement("div",{className:t,onClick:this.handleClick},React.createElement("span",{className:"status-icon","aria-hidden":"true"}),React.createElement("span",{className:"time"},"last updated ",this.state.last_fetched),React.createElement(i,{environmentName:this.props.context.envName})),e)}}),l=React.createClass({displayName:"LoadingDeployForm",render:function(){return React.createElement("div",{className:"deploy-form-loading"},React.createElement("div",{className:"icon-holder"},React.createElement("i",{className:"fa fa-cog fa-spin"}),React.createElement("span",null,this.props.message)))}}),o=React.createClass({displayName:"ErrorMessages",render:function(){return React.createElement("div",{className:"deploy-dropdown-errors"},this.props.message)}}),i=React.createClass({displayName:"EnvironmentName",render:function(){return React.createElement("span",{className:"environment-name"},React.createElement("i",{className:"fa fa-rocket"}," "),"Deployment options ",React.createElement("span",{className:"hidden-xs"},"for ",this.props.environmentName))}}),p=React.createClass({displayName:"DeployForm",getInitialState:function(){return{selectedTab:1,data:[]}},componentDidMount:function(){this.gitData()},gitData:function(){var e=this;e.setState({loading:!0}),Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/git_revisions"})).then(function(t){e.setState({loading:!1,data:t.Tabs}),e.props.lastFetchedHandler(t.last_fetched)},function(e){s.publish("error",e)})},selectHandler:function(e){this.setState({selectedTab:e})},render:function(){return this.state.loading?React.createElement(l,{message:"Loading…"}):React.createElement("div",{className:"deploy-form-outer clearfix"},React.createElement("form",{className:"form-inline deploy-form",action:"POST",action:"#"},React.createElement(d,{data:this.state.data,onSelect:this.selectHandler,selectedTab:this.state.selectedTab}),React.createElement(u,{context:this.props.context,data:this.state.data,selectedTab:this.state.selectedTab,SecurityToken:this.state.SecurityToken})))}}),d=React.createClass({displayName:"DeployTabSelector",render:function(){var e=this,t=this.props.data.map(function(t){return React.createElement(m,{key:t.id,tab:t,onSelect:e.props.onSelect,selectedTab:e.props.selectedTab})});return React.createElement("ul",{className:"SelectionGroup tabbedselectiongroup nolabel"},t)}}),m=React.createClass({displayName:"DeployTabSelect",handleClick:function(e){e.preventDefault(),this.props.onSelect(this.props.tab.id)},render:function(){var e=n.classNames({active:this.props.selectedTab==this.props.tab.id});return React.createElement("li",{className:e},React.createElement("a",{onClick:this.handleClick,href:"#deploy-tab-"+this.props.tab.id},this.props.tab.name))}}),u=React.createClass({displayName:"DeployTabs",render:function(){var e=this,t=this.props.data.map(function(t){return React.createElement(h,{context:e.props.context,key:t.id,tab:t,selectedTab:e.props.selectedTab,SecurityToken:e.props.SecurityToken})});return React.createElement("div",{className:"tab-content"},t)}}),h=React.createClass({displayName:"DeployTab",getInitialState:function(){return{summary:this.getInitialSummaryState(),options:{},sha:""}},getInitialSummaryState:function(){return{changes:{},messages:[],validationCode:"",estimatedTime:null,actionCode:null,initialState:!0}},OptionChangeHandler:function(e){var t=this.state.options;t[e.target.name]=e.target.checked,this.setState({options:t})},SHAChangeHandler:function(e){this.setState({sha:e.target.value})},changeHandler:function(e){if(e.preventDefault(),this.setState({summary:this.getInitialSummaryState()}),""!==e.target.value){s.publish("change_loading");var t={sha:React.findDOMNode(this.refs.sha_selector.refs.sha).value,SecurityID:this.props.SecurityToken};for(var a in this.state.options)this.state.options.hasOwnProperty(a)&&(t[a]=this.state.options[a]);Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/deploy_summary",data:t})).then(function(e){this.setState({summary:e}),s.publish("change_loading/done")}.bind(this),function(){s.publish("change_loading/done")})}},showOptions:function(){return"true"===this.props.tab.advanced_opts},showVerifyButton:function(){return this.showOptions()?!0:"textfield"==this.props.tab.field_type},shaChosen:function(){return""!==this.state.sha},render:function(){var e,t=n.classNames({"tab-pane":!0,clearfix:!0,active:this.props.selectedTab==this.props.tab.id});if("dropdown"==this.props.tab.field_type){var a=this.changeHandler;this.showVerifyButton()&&(a=this.SHAChangeHandler),e=React.createElement(f,{ref:"sha_selector",tab:this.props.tab,changeHandler:a})}else"textfield"==this.props.tab.field_type&&(e=React.createElement(y,{ref:"sha_selector",tab:this.props.tab,changeHandler:this.SHAChangeHandler}));var s=null;this.showOptions()&&(s=React.createElement(R,{tab:this.props.tab,changeHandler:this.OptionChangeHandler}));var c=null;return this.showVerifyButton()&&(c=React.createElement(g,{disabled:!this.shaChosen(),changeHandler:this.changeHandler})),React.createElement("div",{id:"deploy-tab-"+this.props.tab.id,className:t},React.createElement("div",{className:"section"},React.createElement("div",{htmlFor:this.props.tab.field_id,className:"header"},React.createElement("span",{className:"numberCircle"},"1")," ",this.props.tab.field_label),e,s,c),React.createElement(r,{context:this.props.context,summary:this.state.summary}))}}),f=React.createClass({displayName:"SelectorDropdown",componentDidMount:function(){$(React.findDOMNode(this.refs.sha)).select2({data:this.props.tab.field_data}),this.props.changeHandler&&$(React.findDOMNode(this.refs.sha)).select2().on("change",this.props.changeHandler)},render:function(){var e={width:"100%"};return React.createElement("div",null,React.createElement("div",{className:"field"},React.createElement("select",{ref:"sha",id:this.props.tab.field_id,name:"sha",className:"dropdown",onChange:this.props.changeHandler,style:e},React.createElement("option",{value:""},"Select ",this.props.tab.field_id))))}}),y=React.createClass({displayName:"SelectorText",render:function(){return React.createElement("div",{className:"field"},React.createElement("input",{type:"text",ref:"sha",id:this.props.tab.field_id,name:"sha",className:"text",onChange:this.props.changeHandler}))}}),g=React.createClass({displayName:"VerifyButton",render:function(){return React.createElement("div",{className:""},React.createElement("button",{disabled:this.props.disabled,value:"Verify deployment",className:"btn btn-default",onClick:this.props.changeHandler},"Verify deployment"))}}),R=React.createClass({displayName:"AdvancedOptions",render:function(){return React.createElement("div",{className:"deploy-options"},React.createElement("div",{className:"fieldcheckbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",name:"force_full",onChange:this.props.changeHandler}),"Force full deployment")))}});t.exports=c},{"./deploy_plan.jsx":4,"./events.js":6,"./helpers.js":7}],6:[function(e,t,a){var s={},n=s.hasOwnProperty;t.exports={subscribe:function(e,t){n.call(s,e)||(s[e]=[]);var a=s[e].push(t)-1;return{remove:function(){delete s[e][a]}}},publish:function(e,t){n.call(s,e)&&s[e].forEach(function(e){e(void 0!=t?t:{})})}}},{}],7:[function(e,t,a){t.exports={classNames:function(){for(var e="",t=0;t<arguments.length;t++){var a=arguments[t];if(a){var s=typeof a;if("string"===s||"number"===s)e+=" "+a;else if(Array.isArray(a))e+=" "+classNames.apply(null,a);else if("object"===s)for(var n in a)a.hasOwnProperty(n)&&a[n]&&(e+=" "+n)}}return e.substr(1)}}},{}],8:[function(e,t,a){var s=React.createClass({displayName:"SummaryTable",isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0},render:function(){var e=this.props.changes;if(this.isEmpty(e))return null;var t=0,a=Object.keys(e).map(function(a){t++;var s=null;return"undefined"!=typeof e[a].compareUrl&&(s=e[a].compareUrl),"undefined"!=typeof e[a].description?""!==e[a].description?React.createElement(c,{key:t,name:a,description:e[a].description}):React.createElement(r,{key:t,name:a,value:""}):e[a].from!=e[a].to?React.createElement(n,{key:t,name:a,from:e[a].from,to:e[a].to,compareUrl:s}):React.createElement(r,{key:t,name:a,value:e[a].from})});return React.createElement("table",{className:"table table-striped table-hover"},React.createElement("tbody",null,a))}}),n=React.createClass({displayName:"SummaryLine",render:function(){var e=this.props.from,t=this.props.to;null!==e&&40===e.length&&(e=e.substring(0,7)),null!==t&&40===t.length&&(t=t.substring(0,7));var a=null;return null!==this.props.compareUrl&&(a=React.createElement("a",{target:"_blank",href:this.props.compareUrl},"View diff")),React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",null,e),React.createElement("td",null,React.createElement("span",{className:"glyphicon glyphicon-arrow-right"})),React.createElement("td",null,t),React.createElement("td",{className:"changeAction"},a))}}),r=React.createClass({displayName:"UnchangedSummaryLine",render:function(){var e=this.props.value;return null!==e&&40===e.length&&(e=e.substring(0,7)),React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",null,e),React.createElement("td",null," "),React.createElement("td",null,React.createElement("span",{className:"label label-success"},"Unchanged")),React.createElement("td",null," "))}}),c=React.createClass({displayName:"DescriptionOnlySummaryLine",render:function(){return React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",{colSpan:"4",dangerouslySetInnerHTML:{__html:this.props.description}}))}});t.exports=s},{}]},{},[1]);